<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="yes" name="mobile-web-app-capable">
  <meta content="black" name="apple-mobile-web-app-status-bar-style">
  <script src="node_modules/mithril/mithril.min.js"></script>
  <title>Algorave rig</title>
  <style>
    html { 
      background: url("images/kopjie.png") no-repeat center center fixed; 
      background-color: #000;
      text-align: center;
    }

    button {
      border: 2px solid white;
      border-radius: 3px;
      background-color: black;
      color: white;
      font-size: 3em;
      padding: 0.5em 1em;
      margin: 1em;
    }
  </style>
</head>
<body>
<button id="fs">full screen</button>
<script>
  $ = document.getElementById.bind(document);
  $("fs").onclick = function() {
    var el = document.documentElement;
    var fs = el.requestFullScreen || el.mozRequestFullScreen || el.webkitRequestFullScreen;
    fs.bind(el)();
    setTimeout(function() {
      $("fs").style.display = "none";
    }, 100);
  };
  
  document.addEventListener('webkitfullscreenchange', exitHandler, false);
  document.addEventListener('mozfullscreenchange', exitHandler, false);
  document.addEventListener('fullscreenchange', exitHandler, false);
  document.addEventListener('MSFullscreenChange', exitHandler, false);

  function exitHandler() {
    $("fs").style.display = "inline-block";
  }

  m.request({"url": "files.txt", deserialize: function(value) {return value}}).then(function(d) {
    var files = shuffle(d.split("\n"));
    document.documentElement.style.backgroundRepeat = "no-repeat";
    document.documentElement.style.backgroundSize = "contain";
    swapimage(0, files);
  });

  function swapimage(idx, files) {
    var file = files[idx];
    console.log(file);
    if (file.indexOf(".gif") > 0) {
      var timeout = Math.random() * 5000 + 5000;
      console.log("gif", timeout);
    } else {
      var timeout = Math.random() * 2000 + 1000;
      console.log("img", timeout);
    }
    document.documentElement.style.backgroundImage = "url(images/" + file + ")";
    idx += 1;
    setTimeout(function() {
      swapimage(idx + 1, files);
    }, timeout);
  }

  /**
   * Shuffles array in place.
   * @param {Array} a items An array containing the items.
   * https://stackoverflow.com/a/6274398/2131094
   */
  function shuffle(a) {
    var j, x, i;
    for (i = a.length - 1; i > 0; i--) {
      j = Math.floor(Math.random() * (i + 1));
      x = a[i];
      a[i] = a[j];
      a[j] = x;
    }
    return a;
  }
</script>
</body>
</html>

